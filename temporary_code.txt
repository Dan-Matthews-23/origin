def calculate_defence_rank(request):
    for player in UserProfile.objects.all():       
        player_power = PlayerPower.objects.get(user_profile=player)       
        
        troops = Troops.objects.get(user_profile=player)
        total_defence_power = (
        troops.weak_defence_troops * TroopAttributes.objects.get().defence_tier_one_power +
        troops.strong_defence_troops * TroopAttributes.objects.get().defence_tier_two_power +
        troops.elite_defence_troops * TroopAttributes.objects.get().defence_tier_three_power
  )
       
        update_defence = PlayerPower.objects.get(user_profile=player)
        update_defence.defence = total_defence_power
        update_defence.save()
       
        all_players = PlayerPower.objects.all().order_by('-defence')
        update_defence.defence_rank = all_players.filter(defence__gt=update_defence.defence).count() + 1   
        update_defence.defence = total_defence_power
        update_defence.save()
        print(update_defence)
        
    return render(request, 'home/overview.html')